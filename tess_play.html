<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>TESS Playround</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
							<header id="header">
								<a href="index.html" class="logo"><strong>Christopher J. Burke</strong> TESS Research Scientist @ MIT</a>
								<ul class="icons">
									<li><a href="https://twitter.com/curiousterran" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="https://github.com/christopherburke/" class="icon brands fa-github"><span class="label">Github</span></a></li>
									<li><a href="https://orcid.org/0000-0002-7754-9486">ORCID</a></li>
									<li><a href="https://ui.adsabs.harvard.edu/search/filter_database_fq_database=AND&filter_database_fq_database=database%3A%22astronomy%22&filter_property_fq_property=AND&filter_property_fq_property=property%3A%22refereed%22&fq=%7B!type%3Daqp%20v%3D%24fq_database%7D&fq=%7B!type%3Daqp%20v%3D%24fq_property%7D&fq=%7B!type%3Daqp%20v%3D%24fq_aff%7D&fq_aff=(((aff_facet_hier%3A%220%2FSTScI%22%20OR%20aff_facet_hier%3A%220%2FMIT%22%20OR%20aff_facet_hier%3A%220%2FSETI%20Inst%22%20OR%20aff_facet_hier%3A%220%2FNASA%20Ames%22))%20OR%20aff_facet_hier%3A%220%2FHarvard%20U%22%20OR%20aff_facet_hier%3A%220%2FSETI%20Inst%22%20OR%20aff_facet_hier%3A%220%2FNASA%20Ames%22%20OR%20aff_facet_hier%3A%221%2FMIT%2FKavli%20Inst%22%20OR%20aff_facet_hier%3A%221%2FSI%2FCfA%22%20OR%20aff_facet_hier%3A%220%2FSTScI%22)&fq_database=(database%3A%22astronomy%22)&fq_property=(property%3A%22refereed%22)&q=%20author%3A%22Burke%2C%20Christopher%22&sort=date%20desc%2C%20bibcode%20desc&p_=0">ADS</a></li>
									<li><a href="https://scholar.google.com/citations?user=hxo9mEUAAAAJ&hl=en&oi=ao">Google Scholar</a></li>
									<li><a href="https://www.linkedin.com/in/christopher-burke-1b315a130" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li>
								</ul>
							</header>

							<!-- Content -->
								<section>
									<header class="main">
										<h1>TESS Playground</h1>
									</header>

									<span class="image left"><img src="images/TESSInSpaceRender1.jpeg" alt="" /></span>
									Was your star of interest observed by TESS? If so, which sectors and which pixels contain the target?
									Enter the RA and Declination coordinates of a target in the box below and click on the 'Convert RA & Dec Coords' button to find out.
									Alternatively, you can enter a common name for a star or <code>TIC &lt;tic id number&gt;</code> then click on the 'Resolve Name'
									button to find out. In addition, your input stellar coordinates or target name are converted to
									several other standard coordinate formats as a convenience to cut and paste into other web tools.
									Star name resolving provided by the
									<a href="https://vizier.u-strasbg.fr/vizier/doc/sesame.htx">CDS Sesame Name Resolving Service</a>.
									Observability of TESS provided by a webassembly version
									of <a href="https://github.com/christopherburke/tess-point">tess-point</a>.
									Javascript and Python versions of the coordinate conversion code are also <a href="https://github.com/christopherburke/radecparse">available</a>.
									If the target was observed by TESS, then one is given the option to query the <a href="https://archive.stsci.edu/missions-and-data/tess">MAST TESS archive</a>
									and return a table of <a href="https://heasarc.gsfc.nasa.gov/docs/tess/pipeline.html">NASA Ames Science Processing Operations Center (SPOC)</a> lightcurve FITS
									data files if they are available. Not all targets have lightcurves available. If light curves are available, then links
									to download individual FITs files or all light curve files will be presented. A link to preview a lightcurve
									is also available, but due to Cross-Origin Resource Sharing <a href="https://medium.com/@electra_chong/what-is-cors-what-is-it-used-for-308cafa4df1a">(CORS)</a>
									 restrictions, one needs to either download the file locally, go to the <a href="tess_fits_play.html">TESS Light Curve Explorer</a>,
									 and upload the downloaded fits file manually. Alternatively, on can click on the preview light curve link
									 to directly go to the preview after <a href="javascript:void(0)" id="corsDialogLink">CLICKING HERE</a> to read about bypassing CORS protection
									 with a chrome extension.
									 <div id="headerDialog" title="CORS Bypassing">
									<!-- START DIATRIBE ABOUT HOW TO BYPASS CORS -->
									<span id="headerDialogContent">
											I use the Allow CORS: Access-Control-Allow-Origin chrome extension to disable CORS protection.
											After install the extension is not active, one needs to select the extension's icon and in the
											larger window select the large 'C:' icon. If the icon has color then it is active. You
											should add https://mast.stsci.edu to the whitelist as this is the source of the light curve
											fits data. When you are finished with previewing light curves, then select the extension
											icon to 'gray out'/deactivate the extension. This will re-enable CORS protections.
									 </span></div>
									<b><h3>Enter Coordinates or Name of Star:</h3></b>
									<input id="starCoordString" style="width:20em" type="text">
									<div id="starCoordError" style="display: none; color: red;">Error Message!</div>
									<button id="starCoordRunJava">Convert RA & Dec Coords</button>&nbsp;<button id="nameResolveRun">Resolve Name</button></br>
									<!-- Star coordinate output Table -->
									<div class="table-wrapper" id="starCoordOutput" style="display: none;max-width:20em;">
					          <h4>RA & Declination Formats</h4>
					          <table class="alt" id="starCoordOutputTable">
					            <tbody>
											</tbody>
					          </table>
					        </div>
									<button id="queryMAST" style="display: none;">Check MAST for SPOC Light Curve Holdings</button>
									<!-- tess-point output table -->
									<div class="table-wrapper" id="tesspointOutput" style="display: none;max-width:33em;">
					          <h4>TESS Observability</h4>
					          <table class="alt" id="tesspointOutputTable">
											<thead>
												<tr>
													<th>Sector</th>
													<th>Camera</th>
													<th>CCD</th>
													<th>Column [pix]</th>
													<th>Row [pix]</th>
													<th>Edge Warn</th>
												</tr>
											</thead>
					            <tbody>
											</tbody>
					          </table>
					        </div>
									<!-- queryMAST LC holdings Table -->
									<div class="table-wrapper" id="queryMASTOutput" style="display: none;">
										<h4>MAST Light Curve Holdings</h4>
										<table class="alt" id="queryMASTOutputTable">
											<thead>
												<tr>
													<th>TIC ID</th>
													<th>Sector Number</th>
													<th>Exposure Time [s]</th>
													<th>Download</th>
													<th>Light Curve Preview</th>
												</tr>
											</thead>
											<tbody>
											</tbody>
					          </table>
					        </div>

									<!--
									<hr class="major" />

									<h2>Interdum sed dapibus</h2>
									<p>Donec eget ex magna. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque venenatis dolor imperdiet dolor mattis sagittis. Praesent rutrum sem diam, vitae egestas enim auctor sit amet. Pellentesque leo mauris, consectetur id ipsum sit amet, fergiat. Pellentesque in mi eu massa lacinia malesuada et a elit. Donec urna ex, lacinia in purus ac, pretium pulvinar mauris. Curabitur sapien risus, commodo eget turpis at, elementum convallis elit. Pellentesque enim turpis, hendrerit.</p>
									<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis dapibus rutrum facilisis. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Etiam tristique libero eu nibh porttitor fermentum. Nullam venenatis erat id vehicula viverra. Nunc ultrices eros ut ultricies condimentum. Mauris risus lacus, blandit sit amet venenatis non, bibendum vitae dolor. Nunc lorem mauris, fringilla in aliquam at, euismod in lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In non lorem sit amet elit placerat maximus. Pellentesque aliquam maximus risus, vel sed vehicula. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque venenatis dolor imperdiet dolor mattis sagittis. Praesent rutrum sem diam, vitae egestas enim auctor sit amet. Pellentesque leo mauris, consectetur id ipsum sit amet, fersapien risus, commodo eget turpis at, elementum convallis elit. Pellentesque enim turpis, hendrerit tristique lorem ipsum dolor.</p>

									-->

								</section>

						</div>
					</div>

				<!-- Sidebar -->
				<div id="sidebar">
					<div class="inner">
						<!-- Menu -->
							<nav id="menu">
								<header class="major">
									<h2>Menu</h2>
								</header>
								<ul>
									<li><a href="index.html">Homepage</a></li>
									<li><a href="tess_play.html">TESS Playground</a></li>
									<li><a href="tess_fits_play.html">TESS Light Curve Explorer</a></li>
								</ul>
							</nav>
						<!-- Section -->
							<section>
								<header class="major">
									<h2>Get in touch</h2>
									<p>My email address is obfuscated (hopefully) with NATO phonetic alphabet and unicode characters.</p>
								</header>
								<ul class="contact">
									<li class="icon solid fa-envelope">cjburke ⚛ <strong>M</strong>ike&nbsp<strong>I</strong>ndigo&nbsp<strong>T</strong>ango ⚬ <strong>E</strong>cho&nbsp<strong>D</strong>elta&nbsp<strong>U</strong>niform</li>
									<li class="icon solid fa-home">MIT Kavli Institute for Astrophysics and Space Research<br />
									77 Massachusetts Avenue<br />
									Cambridge, MA 02139</li>
								</ul>
							</section>

						<!-- Footer -->
							<footer id="footer">
								<p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
							</footer>

					</div>
				</div>


			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/radecparse.1.1.min.js"></script>
			<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<!-- radecparse and name resolver feed input from text box -->
		<script type='text/javascript'>
			// Webassembly module setup the print function
			// that is linked to the wasi fd_write in tess_stars2px.js that gets populated with the
			// fprintf calls in the c code.
			var Module = {
				preRun: [],
				postRun: [],
				print: (function() {
					return function(text) {
						if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
						// These replacements are necessary if you render to raw HTML
						//text = text.replace(/&/g, "&amp;");
						//text = text.replace(/</g, "&lt;");
						//text = text.replace(/>/g, "&gt;");
						//text = text.replace('\n', '<br>', 'g');
						// remove the \n
						text = shrinkspaces(text).trim();
						text = text.replace('\n', '', 'g');
						let textArr = text.split(' ');
						// There is a header addded to to tess-point output
						// catch it and ignore this line
						if (textArr[0] !== 'Sector') {
							var curHtml = '<tr>';
							for (i=0; i<6; i++) {
								if (typeof textArr[i] !== 'undefined') {
									curHtml = curHtml + '<td>'+ textArr[i] + '</td>';
								}
							}
							curHtml = curHtml + '</tr>';
						}
						$('#tesspointOutput'+'Table > tbody:last-child').append(curHtml);
					};
				})()
			};
		</script>
		<script type='text/javascript'>
		$(document).ready(function() {
			var curlStr = '#!/bin/sh\n'; // Accumulate curl commands for download
      var ticIds = []; // Accmulate target ids that are encountered

			function radecfeedit(inputId, errorId, outputId, outputId2, outputId3) {
				$(errorId).hide();
				$(outputId).hide();
				$(outputId2).hide();
				$(outputId3).hide();
				$(outputId3+"Output").hide();
				$(outputId + "Table tbody").empty();
				$(outputId2 + "Table tbody").empty();
				$(outputId3+"OutputTable tbody").empty();
				$(outputId3).off('click');
				$(outputId3+"Output a").remove();
				$(outputId3).text("Check MAST for SPOC Light Curve Holdings");
				var rdpOut = rdp($(inputId).val());
				if (rdpOut[2]) {
					main_input(rdpOut[0], rdpOut[1], inputId, errorId, outputId, outputId2, outputId3);
				} else {
					$(errorId).text(rdpOut[3]);
					$(errorId).show();
				}
			} // end radecfeedit

			function sesamefeedit(inputId, errorId, outputId, outputId2, outputId3) {
				$(errorId).hide();
				$(errorId).text('Trying to Resolve...');
				$(errorId).show();
				$(outputId).hide();
				$(outputId2).hide();
				$(outputId3).hide();
				$(outputId3+"Output").hide();
				$(outputId + "Table tbody").empty();
				$(outputId2 + "Table tbody").empty();
				$(outputId3+"OutputTable tbody").empty();
				$(outputId3).off('click');
				$(outputId3+"Output a").remove();
				$(outputId3).text("Check MAST for SPOC Light Curve Holdings");
				var urlwant = 'https://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-o';
				var starName = $(inputId).val();
				var valid = false;
				var errorStr = `Could Not Resolve Name: ${starName}`;
				var datasplit = [];
				$.get(urlwant, starName, function(data) {
					let idx = data.indexOf('%J ');
					if (idx > -1) {
						var curdata = data.substr(idx);
						let idx2 = curdata.indexOf('\n');
						if (idx2 > -1) {
  						curdata = curdata.substr(0,idx2);
	  					datasplit = curdata.split(' ');
							valid = true;
							errorStr = '';
							$(errorId).hide();
							main_input(parseFloat(datasplit[1]), parseFloat(datasplit[2]), inputId, errorId, outputId, outputId2, outputId3);
						}
					} else {
						$(errorId).text(errorStr);
						$(errorId).show();
					}
				}); // end get
			} // end sesamefeedit

			$('#starCoordRunJava').click(function() {
				radecfeedit('#starCoordString', '#starCoordError', '#starCoordOutput', '#tesspointOutput', '#queryMAST');
			}); // End Click event
			$('#nameResolveRun').click(function() {
				sesamefeedit('#starCoordString', '#starCoordError', '#starCoordOutput', '#tesspointOutput', '#queryMAST');
			});

			function mastfeedit(ra, dec, errorId, outputId3) {
        curlStr = '#!/bin/sh\n';
        ticIds = [];
        var urlwant = 'https://mast.stsci.edu/api/v0/invoke';
        mastObj = {
          "service":"Mast.Caom.Filtered.Position",
          "format":"json",
          //"pagesize":500,
          //"page":1,
          "params":{
            "columns":"dataURL,obs_id,target_name,t_exptime,sequence_number,t_min,t_max,obsid",
            "filters":[
              {"paramName":"dataproduct_type","values":["timeseries"]},
              {"paramName":"project","values":["TESS"]},
              {"paramName":"provenance_name","values":["SPOC","TESS-SPOC"]}
            ],
            "position":ra.toString()+", "+dec.toString()+", 0.002"
          }
        }
        $.post(urlwant,"request="+JSON.stringify(mastObj), function(data) {
          fill_mast_holding_table(data, outputId3);
        });
      } // end mastfeedit

      function fill_mast_holding_table(data, outputId3) {
        var dataLen = Object.keys(data.data).length;
        if (dataLen == 0) {
          // No data
          $(outputId3).text('No Lightcurves at this location');
        } else {
          //$(errorId).hide();
          // Need to sort the data by sector than by exposure time
          // See https://stackoverflow.com/questions/6913512/how-to-sort-an-array-of-objects-by-multiple-
          //console.log(data.data);
          data.data.sort((a,b) => a.sequence_number - b.sequence_number || a.t_exptime - b.t_exptime);
          //console.log(data.data);
          for (i=0; i<dataLen; i++) {
            let tmp = data.data[i].obs_id;
            let tmp2 = data.data[i].dataURL;
            // Need to filter out dv multisector time series
            var notDV = true;
            if (tmp.substring(0,4) === "tess") {
              // Need to distinguish between multisector dv time series and single Sector lc
              if (data.data[i].dataURL.substr(-7,7) === "lc.fits") {
                var secStr = tmp.substring(18,23);
              } else {
                notDV = false;
              }
            }
            if (tmp.substring(0,4) === "hlsp") {
              var secStr = tmp.substring(42,47);
            }
            if (notDV) {
              $(outputId3+"OutputTable tbody").append(`<tr><td>${data.data[i]["target_name"]}</td><td>${data.data[i].sequence_number}</td><td>${data.data[i]["t_exptime"].toString()}</td><td><a id=${data.data[i].obsid.toString()} href=''>link</a></td><td><a id=${data.data[i].obsid.toString()}_preview href='' target="_blank">link</a></td></tr>`);
              reg_MAST_create_link(data.data[i].dataURL, data.data[i].obsid, data.data[i].target_name, data.data[i].t_exptime);
            }
          }
          $(outputId3+"Output").show();
          // Create download link for the curl script
          var uniqTics = [...new Set(ticIds)];
          var uniqTicsStr = uniqTics.join('_');
          var a = document.createElement("a");
          a.href = window.URL.createObjectURL(new Blob([curlStr], {type:"text/plain"}));
          a.text = 'Download curl script for all light curves';
          var now = new Date();
          a.download = "tess_"+uniqTicsStr+"_"+now.toISOString().substring(0,10)+"_lcs.sh";
          // attach to table section
          $(outputId3+"Output h4").after(a);
					$(outputId3).hide();
					$(outputId3).text("Check MAST for SPOC Light Curve Holdings");
        }
      }

      // From a given obsid set the download link
      function reg_MAST_create_link(dataURL, obsid, tic, expt) {
          var urlwant = 'https://mast.stsci.edu/api/v0.1/Download/file?uri=';
          var request_str = urlwant + dataURL;
          // Make the link
          $('#'+obsid).attr('href',request_str);
					var urlwant2 = 'http://localhost:8000/tess_fits_play.html?uri=';
					var request_str2 = urlwant2 + dataURL;
					$('#'+obsid+'_preview').attr('href', request_str2);
          // append link for curl download
          let fileName = dataURL.split('/');
          fileName = fileName[fileName.length - 1];
          curlStr += 'curl -C - -L -o '+fileName+' "'+request_str+'"\n';
          ticIds.push(tic);
      } // end function

			// This runs main page given ra & dec (NUMBER FORMAT)
			// outputId - is jquery selector for coordinate format table
			// outputId2 - selector for tess-point table
			// outputid3 - selector for MAST holdings table
			function main_input(ra, dec, inputId, errorId, outputId, outputId2, outputId3) {
				var htmlout = '<tr><td>' + ra.toFixed(8) + ' ' + dec.toFixed(8) + '</td></tr>';
				// Run degconvert to get other formats
				var degOut = degconvert(ra, dec);
				if (degOut[0]) {
					for (i=1;i<=5;i++) {
						htmlout = htmlout + "<tr><td>" + degOut[i] + '</td></tr>';
					}
				}
				$(outputId+'Table > tbody:last-child').append(htmlout);
				$(outputId).show();

				// Start the tess-point table
				_tess_stars2px(ra, dec);
				$(outputId2).show();

				// Check to see if tess-point returned any results
				// Get first row first cell of tess-point table
				// The first cell has string 'Star' if nothing was found
				// From tess-point
				var value=$(outputId2+"Table tbody:last-child").html();
				if (value.substring(8,12) !== 'Star') { // There is potential for light curve available
					//console.log('Start MAST LC Query process');
					// Show MAST LC holdings button
					$(outputId3).show();
					// Attach query MAST LC holdings function with ra & dec
					$(outputId3).click(function() {
						//$(outputId3).attr("disabled", "disabled");
						$(this).text("Querying MAST...");
						mastfeedit(ra, dec, errorId, outputId3);
						//$(outputId3).removeAttr("disabled");
					}); // End Click event
				}
			} // end main_input

			// Turn the headerDialog div into a dialog box with jquery
			$('#headerDialog').dialog({
				autoOpen: false,
				width: 'auto',
				height: '480',
				resizable: true,
				draggable: true
			}).css("font-size", "13px");
			// Attach opening headerDialog to headerShow button
			$('#corsDialogLink').click(function() {
				$('#headerDialog').dialog("open");
			});

		}); // End document ready
		</script>
		<script src="assets/js/tess_stars2px.js"></script>


	</body>
</html>
